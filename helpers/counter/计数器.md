[TOC]

# 概述

# 版本

| 版本 | 修改时间 | 修改人  | 修改内容 |
| ------ | ---------- | --------- | ---------- |
|      |          |         |          |
| v0.1 | 2022-02-11 16:22:57    | everest | 初步完成 |

# 详述

存在很多计数性统计，具备以下特点

1. 针对单个实体(如用户),每个实体最多只能计数一次，0或者1
2. 针对某个时间段进行统计，不在这个时间段内的值无效，也就是存在轮转的行为

对应的方案一步步为

1. 直接使用数据库的原始数据
2. 使用数据库的统计信息

方案2肯定比方案1好，但是当并发量高时，统计信息(尤其是历史统计,每个用户就一条的那种)并发量很大，实际性能并不高，所以考虑使用内存计数器

## 内存缓存计数器

1. 对于每个位数,在对应的属性为true时，Set(id,date), id 是int64的实体id，date是轮转的时间段
2. 计数时，只能批量计数,IsSetWithCount(ids),对于返回的第二个返回值，需要进行原始查询，查询后再次Set
3. 轮转时，只需要ClearIfNot(date) 把非本时间段的全部清理

```

```